<!DOCTYPE html>
<html>
  <head>
    <script
      type="text/javascript"
      src="/homey.js"
      data-origin="settings"
    ></script>
  </head>

  <body>
    <p>
      <span style="color: red;">WARNING:</span> The following urls contains a token with access to your Homey, so be careful sharing the urls.
    </p>

    <header class="homey-header">
      <h1 class="homey-title">Cloud url</h1>
    </header>

    <p>
      The following url is the dashboard cloud url for your Homey. This should work over the internet.
    </p>
    
    <div class="homey-form-group">
      <label class="homey-form-label" for="remoteUrl">Url</label>
      <input class="homey-form-input" id="remoteUrl" type="text" value="" readonly />
    </div>

    <button onclick="openRemote()">Open</button>

    <header class="homey-header">
      <h1 class="homey-title">Local url</h1>
    </header>

    <p>
      The following url is the dashboard local url for your Homey. This should only work on your local network.
    </p>
    
    <div class="homey-form-group">
      <label class="homey-form-label" for="localUrl">Url</label>
      <input class="homey-form-input" id="localUrl" type="text" value="" readonly />
    </div>

    <button onclick="openLocal()">Open</button>

    <script type="text/javascript">
      let localUrl;
      let remoteUrl;
      let homey;

      function onHomeyReady(Homey) {
        homey = Homey;

        Homey.get("app_token", function (err, appToken) {
          const urlPostfix = '/app/skogsaas.dashboards/userdata?appToken=' + appToken;

          remoteUrl = location.origin + urlPostfix;
          
          const remoteElement = document.getElementById("remoteUrl");
          remoteElement.value = remoteUrl;

          Homey.get("homey_id", function (err, homeyId) {
            localUrl = 'http://homey-' + homeyId + '.local' + urlPostfix;

            const localElement = document.getElementById("localUrl");
            localElement.value = localUrl;
          });
        });

        Homey.ready();
      }

      function openRemote() {
        homey.openURL(remoteUrl)
      }

      function openLocal() {
        homey.openURL(localUrl)
      }
    </script>
    
  </body>
</html>